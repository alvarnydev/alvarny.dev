---
import { WorkScopes, type WorkScope } from "@/types";
import type { iconPaths } from "./IconPaths";
import Icon from "./Icon.astro";
import Pill from "./Pill.astro";

export const ScopeIconMap: Record<WorkScope, keyof typeof iconPaths> = {
  design: "brush",
  app: "code",
  experience: "cube",
};
---

<work-nav class="flex items-center gap-4 text-2xl">
  <p>Filter:</p>
  <div class="flex gap-2 pt-2 flex-wrap justify-center md:justify-start">
    {
      WorkScopes.map((scope) => (
        <button data-scope={scope}>
          <Pill>
            <Icon icon={ScopeIconMap[scope]} size="1.33em" />{" "}
            {scope.charAt(0).toUpperCase() + scope.slice(1)}
          </Pill>
        </button>
      ))
    }
  </div>
</work-nav>

<script>
  import { isWorkScope, type WorkScope } from "@/types";

  document.addEventListener("astro:page-load", () => {
    class WorkNav extends HTMLElement {
      constructor() {
        super();

        const work = document.querySelector("#work")!;
        const buttons = this.querySelectorAll("button")!;

        const setScope = (scope: WorkScope | null) => {
          // Set button and Pill style
          [...buttons].map((button) => {
            // Reset button and pill styles
            button.classList.remove("active");
            button.querySelector("div")?.classList.add("inactive");

            const buttonScope = button.getAttribute("data-scope");
            const currentWorkScope = work.getAttribute("data-scope");

            // If the button we clicked has the desired scope, set styles
            if (scope && buttonScope == scope) {
              // Check if already active
              if (currentWorkScope == scope) {
                button.classList.remove("active");
                button.querySelector("div")?.classList.add("inactive");
                work.setAttribute("data-scope", "");
              }
              // Else set to active
              else {
                button.classList.add("active");
                button.querySelector("div")?.classList.remove("inactive");
                work.setAttribute("data-scope", scope);
              }
            }
          });
        };

        // Set the scope on button click
        [...buttons].map((button) => {
          button.addEventListener("click", () => {
            const buttonScope = button.getAttribute("data-scope");
            if (buttonScope && isWorkScope(buttonScope)) {
              setScope(buttonScope);
            }
          });
        });

        // Initialize scope state
        const existingScope = document
          .querySelector("#work")
          ?.getAttribute("data-scope");
        if (existingScope && isWorkScope(existingScope))
          setScope(existingScope);
        else setScope(null);
      }
    }
    if (customElements.get("work-nav") === undefined) {
      customElements.define("work-nav", WorkNav);
    }
  });
</script>

<style>
  .active {
    color: var(--gray-0);
  }
</style>
